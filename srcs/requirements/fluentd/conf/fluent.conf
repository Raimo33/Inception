<source>
  @type tail
  @id tail_all_logs
  path /var/log/**/**/*.log
  tag service.*
  format json
  read_from_head true
</source>

<filter service.**>
  @type record_transformer
  enable_ruby
  <record>
    service ${tag_parts[1]}
    filename ${record["path"].split('/').last.gsub('.log', '')}
  </record>
</filter>

<match service.**>
  @type file
  path /centralized-logs/${tag_parts[1]}/${record["filename"]}-${time.strftime('%d-%m-%Y')}.log
  append true
  <format>
    @type json
  </format>
</match>

#TODO usare store per mettere i logs in file separati e togliere la regola make logs
